# é£ä¹¦ç¾¤æœºå™¨äºº - ä»Šå¤©åƒä»€ä¹ˆ

ä¸€ä¸ªé£ä¹¦ç¾¤æœºå™¨äººï¼Œå½“åœ¨ç¾¤é‡Œ@æœºå™¨äººæ—¶ï¼Œä¼šéšæœºè¿”å›ä¸€ä¸ªé¤å…æ¨èã€‚

## åŠŸèƒ½ç‰¹æ€§

- ğŸ¤– å“åº”ç¾¤èŠä¸­çš„@æ¶ˆæ¯
- ğŸ² éšæœºé€‰æ‹©é¤å…
- ğŸ½ï¸ æ”¯æŒ45ä¸ªå€™é€‰é¤å…
- âœ… è‡ªåŠ¨å¤„ç†é£ä¹¦äº‹ä»¶å›è°ƒ

## å¿«é€Ÿå¼€å§‹

### 1. å®‰è£…ä¾èµ–

```bash
npm install
```

### 2. é…ç½®é£ä¹¦åº”ç”¨

#### 2.1 åˆ›å»ºé£ä¹¦åº”ç”¨

1. è®¿é—® [é£ä¹¦å¼€æ”¾å¹³å°](https://open.feishu.cn/)
2. åˆ›å»ºä¼ä¸šè‡ªå»ºåº”ç”¨
3. è®°å½•ä¸‹ `App ID` å’Œ `App Secret`

#### 2.2 é…ç½®æƒé™

åœ¨åº”ç”¨ç®¡ç†é¡µé¢ï¼Œéœ€è¦å¼€å¯ä»¥ä¸‹æƒé™ï¼š
- `im:message` - è·å–ä¸å‘é€å•èŠã€ç¾¤ç»„æ¶ˆæ¯
- `im:message:group_at_msg:readonly` - æ¥æ”¶ç¾¤èŠä¸­@æœºå™¨äººæ¶ˆæ¯äº‹ä»¶

#### 2.3 é…ç½®äº‹ä»¶è®¢é˜…ï¼ˆå›è°ƒï¼‰â­ é‡è¦

**è¿™æ˜¯æœ€å…³é”®çš„ä¸€æ­¥ï¼** å¿…é¡»é…ç½®äº‹ä»¶è®¢é˜…æ‰èƒ½æ¥æ”¶ç¾¤èŠæ¶ˆæ¯ã€‚

1. è¿›å…¥"äº‹ä»¶è®¢é˜…"é¡µé¢
2. **é…ç½®è¯·æ±‚åœ°å€ï¼ˆWebhookï¼‰**ï¼š
   - åœ¨"è¯·æ±‚åœ°å€ URL"ä¸­å¡«å…¥ä½ çš„ Webhook åœ°å€ï¼š`https://your-domain.com/webhook`
   - ç‚¹å‡»"ä¿å­˜"ï¼Œé£ä¹¦ä¼šè‡ªåŠ¨éªŒè¯åœ°å€
   - ç¡®ä¿éªŒè¯æˆåŠŸï¼ˆæ˜¾ç¤º"éªŒè¯æˆåŠŸ"æç¤ºï¼‰
3. **æ·»åŠ è®¢é˜…äº‹ä»¶**ï¼š
   - ç‚¹å‡»"æ·»åŠ äº‹ä»¶"
   - é€‰æ‹©ï¼š`im.message.receive_v1` (æ¥æ”¶æ¶ˆæ¯äº‹ä»¶)
   - ç¡®ä¿äº‹ä»¶çŠ¶æ€ä¸º"å·²è®¢é˜…"
4. **å¯é€‰é…ç½®**ï¼š
   - å¦‚æœé…ç½®äº†åŠ å¯†ï¼Œéœ€è¦å¡«å†™ `Encrypt Key`ï¼ˆéœ€ä¸æœåŠ¡å™¨ç¯å¢ƒå˜é‡ä¸€è‡´ï¼‰
   - å¦‚æœé…ç½®äº†éªŒè¯ä»¤ç‰Œï¼Œéœ€è¦å¡«å†™ `Verification Token`ï¼ˆéœ€ä¸æœåŠ¡å™¨ç¯å¢ƒå˜é‡ä¸€è‡´ï¼‰

> ğŸ“– **è¯¦ç»†é…ç½®æ­¥éª¤è¯·å‚è€ƒï¼š[FEISHU_CONFIG.md](./FEISHU_CONFIG.md)**

#### 2.4 æ·»åŠ æœºå™¨äººåˆ°ç¾¤èŠ

1. åœ¨åº”ç”¨ç®¡ç†é¡µé¢ï¼Œè¿›å…¥"æœºå™¨äºº"åŠŸèƒ½
2. å°†æœºå™¨äººæ·»åŠ åˆ°ç›®æ ‡ç¾¤èŠ

### 3. é…ç½®ç¯å¢ƒå˜é‡

å¤åˆ¶ `.env.example` ä¸º `.env` å¹¶å¡«å†™é…ç½®ï¼š

```bash
cp .env.example .env
```

ç¼–è¾‘ `.env` æ–‡ä»¶ï¼š

```env
FEISHU_APP_ID=your_app_id_here
FEISHU_APP_SECRET=your_app_secret_here
FEISHU_ENCRYPT_KEY=your_encrypt_key_here  # å¯é€‰
FEISHU_VERIFICATION_TOKEN=your_verification_token_here  # å¯é€‰
PORT=3000
```

### 4. å¯åŠ¨æœåŠ¡å™¨

```bash
npm start
```

æˆ–è€…ä½¿ç”¨å¼€å‘æ¨¡å¼ï¼ˆè‡ªåŠ¨é‡å¯ï¼‰ï¼š

```bash
npm run dev
```

### 5. éƒ¨ç½²

#### ä½¿ç”¨ ngrok è¿›è¡Œæœ¬åœ°æµ‹è¯•

```bash
ngrok http 3000
```

å°† ngrok æä¾›çš„ https åœ°å€é…ç½®åˆ°é£ä¹¦åº”ç”¨çš„äº‹ä»¶è®¢é˜…ä¸­ã€‚

#### ç”Ÿäº§ç¯å¢ƒéƒ¨ç½²

æœ¬é¡¹ç›®æ”¯æŒå¤šç§éƒ¨ç½²å¹³å°ï¼Œæ¨èä½¿ç”¨ä»¥ä¸‹å¹³å°ï¼š

##### æ–¹å¼ä¸€ï¼šRailwayï¼ˆæ¨èï¼‰

1. è®¿é—® [Railway](https://railway.app/)
2. ä½¿ç”¨ GitHub è´¦å·ç™»å½•
3. ç‚¹å‡» "New Project" > "Deploy from GitHub repo"
4. é€‰æ‹©ä½ çš„ä»“åº“
5. åœ¨é¡¹ç›®è®¾ç½®ä¸­æ·»åŠ ç¯å¢ƒå˜é‡ï¼š
   - `FEISHU_APP_ID`
   - `FEISHU_APP_SECRET`
   - `FEISHU_ENCRYPT_KEY` (å¯é€‰)
   - `FEISHU_VERIFICATION_TOKEN` (å¯é€‰)
6. Railway ä¼šè‡ªåŠ¨éƒ¨ç½²ï¼Œè·å–ç”Ÿæˆçš„åŸŸå
7. Webhook åœ°å€ï¼š`https://your-app.railway.app/webhook`

##### æ–¹å¼äºŒï¼šRender

1. è®¿é—® [Render](https://render.com/)
2. ä½¿ç”¨ GitHub è´¦å·ç™»å½•
3. ç‚¹å‡» "New" > "Web Service"
4. è¿æ¥ä½ çš„ GitHub ä»“åº“
5. é…ç½®ï¼š
   - Build Command: `npm install`
   - Start Command: `npm start`
6. æ·»åŠ ç¯å¢ƒå˜é‡ï¼ˆåŒ Railwayï¼‰
7. ç‚¹å‡» "Create Web Service"
8. Webhook åœ°å€ï¼š`https://your-app.onrender.com/webhook`

##### æ–¹å¼ä¸‰ï¼šFly.io

1. å®‰è£… Fly CLI: `curl -L https://fly.io/install.sh | sh`
2. ç™»å½•: `fly auth login`
3. éƒ¨ç½²: `fly launch`
4. è®¾ç½®å¯†é’¥: `fly secrets set FEISHU_APP_ID=xxx FEISHU_APP_SECRET=xxx`
5. Webhook åœ°å€ï¼š`https://your-app.fly.dev/webhook`

##### æ–¹å¼å››ï¼šDocker éƒ¨ç½²

```bash
# æ„å»ºé•œåƒ
docker build -t feishu-bot-what-to-eat .

# è¿è¡Œå®¹å™¨
docker run -d \
  -p 3000:3000 \
  -e FEISHU_APP_ID=your_app_id \
  -e FEISHU_APP_SECRET=your_app_secret \
  --name feishu-bot \
  feishu-bot-what-to-eat
```

##### æ–¹å¼äº”ï¼šä¼ ç»ŸæœåŠ¡å™¨éƒ¨ç½²

1. åœ¨æœåŠ¡å™¨ä¸Šå®‰è£… Node.js 18+
2. å…‹éš†é¡¹ç›®: `git clone your-repo-url`
3. å®‰è£…ä¾èµ–: `npm install`
4. é…ç½®ç¯å¢ƒå˜é‡
5. ä½¿ç”¨ PM2 è¿è¡Œ: `pm2 start server.js --name feishu-bot`
6. é…ç½® Nginx åå‘ä»£ç†ï¼ˆå¯é€‰ï¼‰

**éƒ¨ç½²åè·å– Webhook åœ°å€ï¼š**

éƒ¨ç½²å®Œæˆåï¼Œä½ çš„ Webhook åœ°å€æ ¼å¼ä¸ºï¼š
- Railway: `https://your-app.railway.app/webhook`
- Render: `https://your-app.onrender.com/webhook`
- Fly.io: `https://your-app.fly.dev/webhook`
- è‡ªå®šä¹‰åŸŸå: `https://your-domain.com/webhook`

å°†æ­¤åœ°å€é…ç½®åˆ°é£ä¹¦åº”ç”¨çš„äº‹ä»¶è®¢é˜…ä¸­ã€‚

## ä½¿ç”¨æ–¹æ³•

åœ¨é£ä¹¦ç¾¤èŠä¸­ï¼Œ@æœºå™¨äººæˆ–å‘é€åŒ…å«@æœºå™¨äººçš„æ¶ˆæ¯ï¼Œæœºå™¨äººä¼šè‡ªåŠ¨å›å¤ä¸€ä¸ªéšæœºé¤å…ã€‚

ä¾‹å¦‚ï¼š
```
@ä»Šå¤©åƒä»€ä¹ˆ
```

æœºå™¨äººä¼šå›å¤ï¼š
```
ğŸ² ä»Šå¤©å»åƒï¼š**å¯¿å¸æ²¼æ´¥æ¸¯æ¼•æ²³æ³¾å°è±¡åŸåº—** ğŸ½ï¸
```

## è‡ªå®šä¹‰é¤å…åˆ—è¡¨

ç¼–è¾‘ `restaurants.json` æ–‡ä»¶ï¼Œä¿®æ”¹é¤å…åˆ—è¡¨ï¼š

```json
[
  "é¤å…1",
  "é¤å…2",
  "é¤å…3"
]
```

ä¿®æ”¹åé‡å¯æœåŠ¡å™¨å³å¯ç”Ÿæ•ˆã€‚

## é¡¹ç›®ç»“æ„

```
feishu_bot_what_to_eat/
â”œâ”€â”€ server.js           # ä¸»æœåŠ¡å™¨æ–‡ä»¶
â”œâ”€â”€ restaurants.json    # é¤å…åˆ—è¡¨
â”œâ”€â”€ package.json        # é¡¹ç›®é…ç½®
â”œâ”€â”€ .env.example        # ç¯å¢ƒå˜é‡ç¤ºä¾‹
â””â”€â”€ README.md          # è¯´æ˜æ–‡æ¡£
```

## æ³¨æ„äº‹é¡¹

1. ç¡®ä¿æœåŠ¡å™¨å¯ä»¥è®¿é—®é£ä¹¦å¼€æ”¾å¹³å° APIï¼ˆéœ€è¦å¤–ç½‘è®¿é—®ï¼‰
2. å¦‚æœä½¿ç”¨åŠ å¯†ï¼Œéœ€è¦æ­£ç¡®é…ç½® `FEISHU_ENCRYPT_KEY`
3. æœºå™¨äººéœ€è¦è¢«æ·»åŠ åˆ°ç¾¤èŠä¸­æ‰èƒ½æ¥æ”¶æ¶ˆæ¯
4. ç¡®ä¿åº”ç”¨æœ‰è¶³å¤Ÿçš„æƒé™

## æ•…éšœæ’æŸ¥

### æœºå™¨äººä¸å“åº”æ¶ˆæ¯

1. æ£€æŸ¥åº”ç”¨æƒé™æ˜¯å¦å·²å¼€å¯
2. æ£€æŸ¥äº‹ä»¶è®¢é˜…æ˜¯å¦æ­£ç¡®é…ç½®
3. æ£€æŸ¥æœåŠ¡å™¨æ—¥å¿—æ˜¯å¦æœ‰é”™è¯¯
4. ç¡®è®¤æœºå™¨äººå·²æ·»åŠ åˆ°ç¾¤èŠ

### Token è·å–å¤±è´¥

1. æ£€æŸ¥ `APP_ID` å’Œ `APP_SECRET` æ˜¯å¦æ­£ç¡®
2. æ£€æŸ¥ç½‘ç»œè¿æ¥æ˜¯å¦æ­£å¸¸
3. æŸ¥çœ‹æœåŠ¡å™¨æ—¥å¿—é”™è¯¯ä¿¡æ¯

## License

MIT

